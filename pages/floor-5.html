<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Новости — ATU / Портал</title>
  <link rel="icon" type="image/png" href="../media/atu-logo-atu-letter-atu.jpg">

  <!-- общие стили проекта -->
  <link rel="stylesheet" href="../page.css">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand-1: #0ea5e9;
      --brand-2: #0369a1;
      --bg: #f6f8fc;
      --card: #ffffff;
      --muted: #64748b;
      --radius: 12px;
    }
    [data-theme="dark"]{
      --bg: #071029;
      --card: #071826;
      --muted: #94a3b8;
      color: #e6eef6;
      background: linear-gradient(180deg,#041428,#071029);
    }
    body { background: var(--bg); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; color: #0f172a; }

    .site {
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }

    header.site-header{
      background: linear-gradient(90deg, rgba(3,105,161,0.06), rgba(14,165,233,0.04));
      border-bottom: 1px solid rgba(2,6,23,0.04);
      padding: 18px 6%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .brand { display:flex; gap:12px; align-items:center; text-decoration:none; color:inherit; }
    .brand .logo {
      width:46px; height:46px; background:linear-gradient(135deg,var(--brand-1),var(--brand-2));
      border-radius:10px; display:grid; place-items:center; color:#fff; font-weight:700;
      box-shadow: 0 6px 18px rgba(3,105,161,0.12);
    }
    nav.main-nav { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    nav.main-nav a { text-decoration:none; padding:8px 12px; border-radius:10px; color:var(--brand-2); border:1px solid rgba(3,105,161,0.08); background:transparent; font-weight:600; }
    nav.main-nav a:hover { transform:translateY(-2px); }

    main.container { padding:32px 6%; max-width:1200px; margin:0 auto; width:100%; box-sizing:border-box; }
    .grid {
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
      align-items:start;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: 0 14px 36px rgba(2,6,23,0.06);
      border:1px solid rgba(2,6,23,0.04);
    }

    .news-list { display:flex; flex-direction:column; gap:12px; }
    .news-item {
      display:flex; gap:12px; align-items:flex-start;
      padding:12px; border-radius:10px; transition:transform .18s ease, box-shadow .18s ease;
      background: linear-gradient(180deg, rgba(14,165,233,0.02), transparent);
    }
    .news-item:hover { transform:translateY(-6px); box-shadow:0 12px 30px rgba(2,6,23,0.08); }
    .news-item .meta { font-size:0.87rem; color:var(--muted); min-width:110px; }
    .news-item h4 { margin:0; font-size:1rem; }
    .news-item a { color: inherit; text-decoration:none; font-weight:600; }

    aside .widget { margin-bottom:16px; }
    .btn { display:inline-block; padding:8px 12px; border-radius:10px; text-decoration:none; border:1px solid rgba(0,0,0,0.08); background:#fff; cursor:pointer; }
    .btn.primary { background:var(--brand-1); color:#fff; border:none; }

    .controls { display:flex; gap:8px; align-items:center; }

    /* scroll to top */
    #toTop {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width:48px; height:48px; border-radius:12px;
      display:grid; place-items:center; box-shadow:0 8px 20px rgba(2,6,23,0.12);
      background:var(--brand-1); color:#fff; border:none; cursor:pointer; z-index:200;
      transition:transform .18s ease, opacity .12s ease;
      opacity: 0; transform: translateY(8px) scale(.96);
    }
    #toTop.show { opacity:1; transform:none; }

    /* responsive */
    @media (max-width:980px){
      .grid { grid-template-columns: 1fr; }
      nav.main-nav { display:none; }
      header .mobile-nav { display:flex; gap:8px; }
    }
    @media (max-width:420px){
      .brand .logo { width:40px; height:40px; }
      .news-item .meta { display:none; }
    }

    /* small animations */
    .fade-in { animation: fadeIn .5s ease both; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
  </style>
</head>

<body class="auth-page">
  <div class="site" id="site-root" data-theme="light">
    <header class="site-header">
      <a href="../index.html" class="brand" aria-label="Главная">
        <div class="logo">PT</div>
        <div>
          <div style="font-weight:700;">ATU Portal</div>
          <div style="font-size:0.85rem; color:var(--muted)">Новости — Актуальное</div>
        </div>
      </a>

      <nav>
        <div class="controls" style="gap:8px;">
          <nav class="main-nav" aria-label="Основное меню">
            <a href="../index.html">Главная</a>
            <a href="https://atu.edu.kz/kk/">О проекте</a>
            <a href="https://atu.edu.kz/kk/">Контакты</a>
          </nav>

          <div class="mobile-nav" style="display:none;">
            <button id="theme-toggle" class="btn" title="Темная тема">Тема</button>
          </div>
          <button id="theme-toggle-2" class="btn" title="Темная тема">Тема</button>
        </div>
      </nav>
    </header>

    <main class="container" role="main">
      <section class="grid">
        <!-- left -->
        <section class="card fade-in" aria-labelledby="news-heading">
          <header style="display:flex; justify-content:space-between; align-items:center;">
            <div>
              <h2 id="news-heading" class="auth-title" style="margin:0 0 6px">Жаңалықтар — Актуальное</h2>
              <p class="auth-sub" style="margin:0">Новости взяты с сайта АТУ (попытка динамической загрузки). Если загрузка не удалась — отображается кеш.</p>
            </div>
            <div>
              <button id="refresh-news" class="btn">Обновить</button>
            </div>
          </header>

          <div id="news-feed" class="news-list" aria-live="polite" style="margin-top:14px;">
            <!-- новости будут подставлены JS -->
          </div>

          <div style="margin-top:18px; display:flex; gap:8px;">
            <a class="btn" href="https://atu.edu.kz/kk/news/" target="_blank" rel="noopener">Источник — AТУ</a>
            <a class="btn primary" href="../index.html">Вернуться</a>
          </div>
        </section>

        <!-- right sidebar -->
        <aside>
          <div class="card widget">
            <h3 style="margin-top:0">Контакты</h3>
            <p class="auth-sub" style="margin:6px 0">Быстрый контакт по вопросам мероприятий.</p>
            <form id="contact-form" novalidate>
              <div class="field">
                <label for="cname">Имя</label>
                <input id="cname" type="text" placeholder="Ваше имя" required>
              </div>
              <div class="field">
                <label for="cemail">Email</label>
                <input id="cemail" type="email" placeholder="email@пример.ком" required>
              </div>
              <div class="field">
                <label for="cmsg">Сообщение</label>
                <input id="cmsg" type="text" placeholder="Коротко..." required>
              </div>
              <div style="display:flex; gap:8px;">
                <button type="submit" class="btn primary">Отправить</button>
                <button type="button" id="clear-contact" class="btn">Очистить</button>
              </div>
            </form>
          </div>

          <div class="card widget">
            <h3 style="margin-top:0">Мини — ToDo</h3>
            <p class="auth-sub" style="margin:6px 0">Быстрые заметки</p>
            <div style="display:flex; gap:8px;">
              <input id="todo-input" placeholder="Добавить задачу" style="flex:1; padding:8px; border-radius:8px; border:1px solid rgba(2,6,23,0.06)">
              <button id="todo-add" class="btn">Добавить</button>
            </div>
            <ul id="todo-list" style="margin-top:10px; padding-left:18px"></ul>
          </div>

          <div class="card widget">
            <h3 style="margin-top:0">Превью</h3>
            <p class="auth-sub" style="margin:6px 0">Короткая мини-галерея</p>
            <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px;">
              <div style="height:64px; border-radius:8px; background:linear-gradient(180deg,#e6f7ff,#f3fbff)"></div>
              <div style="height:64px; border-radius:8px; background:linear-gradient(180deg,#fff0f6,#fff7fb)"></div>
              <div style="height:64px; border-radius:8px; background:linear-gradient(180deg,#f0fff4,#f7fff8)"></div>
            </div>
          </div>
        </aside>
      </section>
    </main>

    <footer style="padding:18px 6%; text-align:center; font-size:0.9rem; color:var(--muted);">
      <small>© 2025 Path The Mods — учебный портал. Источник новостей: АТУ — Жаңалықтар. :contentReference[oaicite:1]{index=1}</small>
    </footer>
  </div>

  <!-- кнопка наверх -->
  <button id="toTop" aria-label="Наверх">↑</button>

  <script>
    // ---------- Utils ----------
    function el(tag, props = {}, children = []) {
      const e = document.createElement(tag);
      Object.entries(props).forEach(([k,v]) => { if(k in e) e[k]=v; else e.setAttribute(k,v); });
      (Array.isArray(children) ? children : [children]).forEach(c => { if(typeof c === 'string') e.appendChild(document.createTextNode(c)); else if(c) e.appendChild(c); });
      return e;
    }

    // ---------- News loader ----------
    const NEWS_SRC = 'https://atu.edu.kz/kk/news/';
    const newsFeed = document.getElementById('news-feed');
    const refreshBtn = document.getElementById('refresh-news');

    // cached fallback (скопировано с сайта при проверке) — на случай CORS
    const CACHE = [
      { title: '«Педагогикалық шеберліктің жазғы мектебі»', date: '15 Августа 2025', href: NEWS_SRC },
      { title: 'Құрметті Жетісу облысының талапкерлері!', date: '12 Августа 2025', href: NEWS_SRC },
      { title: 'АТУ қабылдау комиссиясына құжаттарыңды тапсырып үлгер', date: '11 Августа 2025', href: NEWS_SRC },
      { title: 'Барлық мемлекеттік грант иегерлерін құттықтаймыз!', date: '7 Августа 2025', href: NEWS_SRC },
      { title: 'ЖАТАҚХАНАҒА ОРНАЛАСУ ЖӨНІНДЕГІ НҰСҚАУЛЫҚ', date: '6 Августа 2025', href: NEWS_SRC }
    ];

    function renderNews(items){
      newsFeed.innerHTML = '';
      items.forEach(it => {
        const node = el('article', { className: 'news-item' }, [
          el('div', { className: 'meta' }, it.date || ''),
          el('div', {}, [
            el('h4', {}, [ el('a', { href: it.href || NEWS_SRC, target: '_blank', rel:'noopener' }, it.title) ]),
            it.excerpt ? el('p', { style: 'margin:6px 0;color:var(--muted)' }, it.excerpt) : null
          ])
        ]);
        newsFeed.appendChild(node);
      });
    }

    async function loadRemoteNews(){
      try {
        const res = await fetch(NEWS_SRC, { mode: 'cors' });
        const text = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');

        // best-effort: выбрать ссылки из страницы с краткими датами
        // ищем все ссылочные элементы внутри основного контента, которые ведут на новости
        const links = Array.from(doc.querySelectorAll('a'))
          .filter(a => a.href && /news/i.test(a.href))
          .slice(0, 12);

        const items = links.map(a => {
          // попробовать найти дату в соседнем текстовом узле
          let date = '';
          const parent = a.parentElement;
          if(parent){
            const text = parent.textContent || '';
            const m = text.match(/(\\d{1,2}\\s+\\w+\\s+\\d{4}|\\d{1,2}\\s+\\w+го?\\w*)/i);
            if(m) date = m[0].trim();
          }
          return { title: a.textContent.trim(), href: a.href, date };
        }).filter(i => i.title);

        if(items.length) {
          renderNews(items);
          return;
        }
        // fallback to our cache
        renderNews(CACHE);
      } catch (err) {
        // CORS или другая ошибка — показываем кеш
        console.warn('Не удалось загрузить новости (CORS/сеть). Показываем кеш.', err);
        renderNews(CACHE);
      }
    }

    // initial
    loadRemoteNews();

    refreshBtn.addEventListener('click', () => {
      refreshBtn.disabled = true;
      refreshBtn.textContent = 'Обновляем...';
      loadRemoteNews().finally(()=>{
        refreshBtn.disabled = false;
        refreshBtn.textContent = 'Обновить';
      });
    });

    // ---------- scroll to top ----------
    const toTop = document.getElementById('toTop');
    window.addEventListener('scroll', () => {
      if(window.scrollY > 300) toTop.classList.add('show'); else toTop.classList.remove('show');
    });
    toTop.addEventListener('click', () => window.scrollTo({ top:0, behavior:'smooth' }));

    // ---------- contact form validation ----------
    const contact = document.getElementById('contact-form');
    contact.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('cname'), email = document.getElementById('cemail'), msg = document.getElementById('cmsg');
      if(!name.value.trim() || !email.value.trim() || !msg.value.trim()){
        alert('Заполните все обязательные поля.');
        return;
      }
      // простая валидация email
      const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
      if(!re.test(email.value)){
        alert('Введите корректный email.');
        email.focus();
        return;
      }
      // имитация отправки
      alert('Сообщение отправлено! (локально)');
      contact.reset();
    });
    document.getElementById('clear-contact').addEventListener('click', () => contact.reset());

    // ---------- todo ----------
    const todoInput = document.getElementById('todo-input');
    const todoAdd = document.getElementById('todo-add');
    const todoList = document.getElementById('todo-list');

    function addTodo(text){
      if(!text.trim()) return;
      const li = document.createElement('li');
      li.textContent = text;
      li.style.cursor = 'pointer';
      li.addEventListener('click', () => li.remove());
      todoList.appendChild(li);
      todoInput.value = '';
    }
    todoAdd.addEventListener('click', () => addTodo(todoInput.value));
    todoInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') addTodo(todoInput.value); });

    // ---------- theme toggle ----------
    const themeToggles = document.querySelectorAll('#theme-toggle, #theme-toggle-2');
    function setTheme(name){
      document.getElementById('site-root').setAttribute('data-theme', name);
      localStorage.setItem('pt_theme', name);
    }
    const saved = localStorage.getItem('pt_theme') || 'light';
    setTheme(saved);
    themeToggles.forEach(btn => btn.addEventListener('click', () => {
      const cur = document.getElementById('site-root').getAttribute('data-theme');
      setTheme(cur === 'light' ? 'dark' : 'light');
    }));

  </script>
</body>
</html>
